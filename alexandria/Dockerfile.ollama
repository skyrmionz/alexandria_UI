FROM ollama/ollama:latest

# 1) Install psmisc so we have 'killall'
RUN apt-get update && apt-get install -y psmisc && rm -rf /var/lib/apt/lists/*

# 2) Start Ollama in the background, wait a bit, pull the model, then kill the server
RUN /bin/bash -c "ollama serve & sleep 5 && ollama pull deepseek-r1:latest && killall ollama"

# 3) At runtime, just run Ollama in server mode (model is already cached)
CMD ["serve"]